# Memory Syscall Conformance Specifications
# Tests for memory operations: MLOAD, MSTORE, MSTORE8, MSIZE, MCOPY

---
spec:
  name: syscall_mload_basic
  version: "1.0"
  category: syscalls
  subcategory: memory
  description: "Load 32 bytes from memory"
  priority: P0

preconditions:
  - memory:
      offset: 0
      value: "0x0000000000000000000000000000000000000000000000000000000000000042"

action:
  type: syscall
  name: mload
  params:
    offset: 0

expected:
  status: success
  result: "0x0000000000000000000000000000000000000000000000000000000000000042"
  gas_used: 3

---
spec:
  name: syscall_mload_uninitialized
  version: "1.0"
  category: syscalls
  subcategory: memory
  description: "Load from uninitialized memory returns zeros"
  priority: P0

preconditions:
  - memory: empty

action:
  type: syscall
  name: mload
  params:
    offset: 0

expected:
  status: success
  result: "0x0000000000000000000000000000000000000000000000000000000000000000"

---
spec:
  name: syscall_mstore_basic
  version: "1.0"
  category: syscalls
  subcategory: memory
  description: "Store 32 bytes to memory"
  priority: P0

preconditions:
  - memory: empty

action:
  type: syscall
  name: mstore
  params:
    offset: 0
    value: "0x0000000000000000000000000000000000000000000000000000000000000042"

expected:
  status: success
  gas_used: 3

postconditions:
  - memory:
      offset: 0
      value: "0x0000000000000000000000000000000000000000000000000000000000000042"

---
spec:
  name: syscall_mstore8_basic
  version: "1.0"
  category: syscalls
  subcategory: memory
  description: "Store single byte to memory"
  priority: P0

preconditions:
  - memory: empty

action:
  type: syscall
  name: mstore8
  params:
    offset: 0
    value: 0x42

expected:
  status: success
  gas_used: 3

postconditions:
  - memory:
      offset: 0
      byte_value: 0x42

---
spec:
  name: syscall_msize_initial
  version: "1.0"
  category: syscalls
  subcategory: memory
  description: "Initial memory size is zero"
  priority: P0

preconditions:
  - memory: empty

action:
  type: syscall
  name: msize

expected:
  status: success
  result: 0
  gas_used: 2

---
spec:
  name: syscall_msize_after_store
  version: "1.0"
  category: syscalls
  subcategory: memory
  description: "Memory size after store operation"
  priority: P1

preconditions:
  - memory: empty
  - operations:
      - mstore:
          offset: 0
          value: 1

action:
  type: syscall
  name: msize

expected:
  status: success
  result: 32  # Memory expands in 32-byte words

---
spec:
  name: syscall_mcopy_basic
  version: "1.0"
  category: syscalls
  subcategory: memory
  description: "Copy memory region (EIP-5656)"
  priority: P1

preconditions:
  - memory:
      offset: 0
      value: "0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef"

action:
  type: syscall
  name: mcopy
  params:
    dest: 32
    src: 0
    length: 32

expected:
  status: success
  gas_used: "<= 12"  # 3 + 3 * ceil(32/32)

postconditions:
  - memory:
      offset: 32
      value: "0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef"

---
spec:
  name: syscall_mcopy_overlap_forward
  version: "1.0"
  category: syscalls
  subcategory: memory
  description: "Memory copy with forward overlapping regions"
  priority: P2

preconditions:
  - memory:
      offset: 0
      value: "0x0102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f20"

action:
  type: syscall
  name: mcopy
  params:
    dest: 16
    src: 0
    length: 32

expected:
  status: success
  # Copy should work correctly even with overlap

postconditions:
  - memory:
      offset: 0
      value: "0x01020304050607080102030405060708090a0b0c0d0e0f101112131415161718"
